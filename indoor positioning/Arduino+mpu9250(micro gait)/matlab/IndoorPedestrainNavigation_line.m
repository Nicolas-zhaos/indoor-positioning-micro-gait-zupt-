     

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Error state matrix : delta_x=[delta_fai,  delta_w,      delta_r,    delta_v,   delta_a];
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


clear;


Path ='line_3_0228.txt';
data = load(Path);
timestamp = data(:,1);
datasize = length(timestamp);

acc_s = data(:,2:4)';
gyro_s = data(:,5:7)';


g0 = 9.78049; %Equatorial gravity acceleration赤道重力加速度
U = 34; %latitude纬度
h = 420; %altitude海拔
g = g0*(1+0.0052884*sin(U)^2 - h*3.14e-7) - 0.0000059*sin(2*U)^2; %Calculate gravity

%Direction angle initialization方向角初始化
pitch = -asin(acc_s(1,1)/g);
roll = atan(acc_s(2,1)/acc_s(3,1));
yaw = 0;

% Conversion from the equipment coordinate system to the navigation coordinate system
C = [cos(pitch)*cos(yaw)    (sin(roll)*sin(pitch)*cos(yaw))-(cos(roll)*sin(yaw))    (cos(roll)*sin(pitch)*cos(yaw))+(sin(roll)*sin(yaw));
    cos(pitch)*sin(yaw)     (sin(roll)*sin(pitch)*sin(yaw))+(cos(roll)*cos(yaw))   (cos(roll)*sin(pitch)*sin(yaw))-(sin(roll)*cos(yaw));
    -sin(pitch)                 sin(roll)*cos(pitch)                                                 cos(roll)*cos(pitch)];
C_pre = C;

% get bias
fid=fopen('biasLine.txt','r');
bias_data=[];
while 1
    tline=fgetl(fid);
    if ~ischar(tline),break;end
    tline=str2num(tline);
    bias_data=[bias_data;tline];
end
fclose(fid);
% Kalman matrix parameter卡尔曼矩阵参数
delta_x = zeros(15,1);
delta_x(4:6) = [bias_data(1); bias_data(2); bias_data(3);];
delta_x(13:15) = [bias_data(4); bias_data(5); bias_data(6)-g;];

%误差矩阵，diagonal 15x15 matrix
%如果P为1，则Gk为1，使用观测值来代表当前的预测值
%如果P为0，则Gk为0，使用上一次的预测值来代表当前的预测值
%因为陀螺仪(4：6)和加速度计(13：15)的数值是有噪声的，所以使用预测值而不是带有噪声的观测值
%Error matrix, 15x15
%If P is 1, then Gk is 1, using the observation value to represent the current prediction value
%If P is 0, then Gk is 0, using the previous prediction value to represent the current prediction value
%Because the values of the gyroscope (4:6) and the accelerometer (13:15) are noisy, the predicted values are used instead of the observed values with noise.
P = diag([1 1 1     0 0 0     1 1 1     1 1 1     0 0 0]);

%观测噪声协方差矩阵 Compass(1),HDR(1),ZARU(3),ZUPT(3)
%R为0，则Gk为1，使用观测值来代表当前的预测
%磁力计由于容易受外界影响，所以方差给的大，表示不是很相信他所得的数据
% observational noise covariance matrix Compass (1), HDR (1), ZARU (3), ZUPT (3)
%R is 0, and Gk is 1, using the observation value to represent the current prediction
%The magnetometer is so large that the variance is given because it is easily influenced by the outside world, indicating that the data is not very confident of the data he gets.
R = diag([ 0 0.01 0.01 0.01 0.01 0.01 0.01]); %Use 0 to indicate a total belief in the value of HDR使用0表示完全相信HDR的值
R2 = diag([ 0.01 0.01 0.01 ]);
% 系统过程噪声协方差矩阵，表示预测模型本身的噪声，初值给的很小
%The system process noise covariance matrix indicates the noise of the prediction model itself, and the initial value is very small.
Q = diag([0.0001 0.0001 0.0001 zeros(1,3) zeros(1,3) 0.0001 0.0001 0.0001  zeros(1,3)]);

% IEZ + HDR + ZARU
H = [[0 0 1]  zeros(1,3) zeros(1,3) zeros(1,3) zeros(1,3);
    zeros(3)  eye(3) zeros(3) zeros(3) zeros(3);
    zeros(3) zeros(3) zeros(3) eye(3) zeros(3)];

H3 = [zeros(3,3) zeros(3,3) zeros(3,3) zeros(3,3) zeros(3,3)];
H3(3,15) = 1;
% Record the acceleration of the navigation frame
acc_n = nan(3,datasize);
acc_n(:,1) = C*acc_s(:,1);


vel_n = nan(3,datasize);
vel_n(:,1) = [0 0 0]';

pos_n = nan(3,datasize);
pos_n(:,1) = [0 0 0]';

distance = nan(1,datasize-1);
distance(1) = 0;


heading = nan(1,datasize);
heading(1) = yaw;

sigma_noise = 1e-4;


yaw_threshold = deg2rad(4);

%Judgment stance phase
isStance = StanceDetection(acc_s, gyro_s, datasize);
% gets the data（ to be calibrated）;
acc_np = [9.31670746834209,9.63879381200896,9.61626427331341,9.59902969018232,9.61935607438611,9.61722503367279,9.60023554154298,9.62019909887024,9.56707668029862,9.60648102463282,9.59334850819614,9.58309871653751,9.57369203559661,9.56275190003188,9.59668108635570,9.62212260498975,9.58277470328712,9.60270572297309,9.59233764141336,9.58461813700285,9.57764989859923,9.57591647617319,9.63417870818530,9.61264059529364,9.61319032732518,9.62223616310062,9.59510651825424,9.57985306056071,9.60090023019531,9.59267210456397,9.60183363145646,9.59157566151898,9.59555454303079,9.60598849842568,9.60964971170217,9.58926501718919,9.58935789315328,9.58486357429783,9.56671877478472,9.60519258591324,9.60916232903327,9.58938458824517,9.62362414557896,9.58368237577389,9.60486241354714,9.60261411077668,9.59952373465823,9.58811636752046,9.59731558649306,9.58314931843792,9.57894590798888,9.60015945935701,9.57170498383232,9.59515268301613,9.57922893291650,9.57139210616219,9.58837455182926,9.60240706848356,9.60662654742276,9.58969163083629,9.58691762570494,9.59750930903683,9.57598606205195,9.56414371988877,9.61388787849212,9.59640237405698,9.60006014574567,9.58168569758121,9.58838601902167,9.57366466798869,9.56827504344100,9.59674730714560,9.57556788553358,9.57013890162447,9.57725223287849,9.59071169659712,9.58014775175354,9.60931271136653,9.60370360813877,9.58696454327464,9.58304934460600,9.60741104504177,9.56773277550699,9.59492517376136,9.63124596668596,9.58968688797008,9.61234488940115,9.61703483520855,9.62461624746768,9.62367426345668,9.61301887809424,9.64167619146931,9.61974060279446,9.61226328215524,9.61218478795574,9.62056363032625,9.60900034312561,9.58554965180888,9.61614325501955,9.58199941815867,9.59082267550700,9.55705526787009,9.58899633660007,9.59450989968661,9.57019070874552,9.57965175963143,9.57271654369676,9.61361315700312,9.60159231469896,9.61991258334838,9.61603690205000,9.58473557373794,9.56150163280317,9.58087324865064,9.59891335966211,9.61135487941041,9.57881924737492,9.61145279852316,9.63839687066456,9.64140167844858,9.55225784449219,9.55899791449132,9.55031592986265,9.57451036046622,9.57201552953062,9.55031855350431,9.54997918918946,9.56544953105610,9.58613843341584,9.58118995860370,9.58227966169359,9.56952147611810,9.60397866400743,9.61080860791989,9.57834456302945,9.54701957333886,9.56553402008411,9.57152619499166,9.57956744055897,9.59738957110629,9.59677902611987,9.59667993317843,9.60552456010601,9.58326670695860,9.61581759498859,9.61193124957711,9.58414021913738,9.60622716451699,9.59636579780493,9.58202621241271,9.57728044664362,9.59645273217506,9.56444543997435,9.56653777738435,9.56589215901573,9.52610180436248,9.51306395098641,9.57985981039080,9.61047337227769,9.58762000423927,9.60368563419582,9.57915761904625,9.58078663449135,9.63346164631131,9.64240089001230,9.61519257978332,9.59935192880729,9.59607027804009,9.62458751589967,9.60104039523320,9.54624356799983,9.57337780754801,9.58557532026605,9.60774468378888,9.64154151650190,9.60812353189273,9.59666847919807,9.56601975449602,9.62199721521748,9.59503167991331,9.60390376071623,9.62176649641624,9.60337274138148,9.60836958110635,9.57711905793754,9.58244268660763,9.60630021473214,9.62077675063554,9.60106664698595,9.58527824240585,9.60070409375988,9.57476988067947,9.60393198638564,9.64421772942478,9.61997078310368,9.56666273792942,9.56262665584000,9.61867679254753,9.58611058461962,9.58386022825578,9.56893496201166,9.56606712033361,9.54146722192773,9.58632813894146,9.60137081119883,9.60104902231636,9.57085076234354,9.56849168319585,9.59179647683978,9.56570210159067,9.55248922567155,9.59380820037335,9.55011795680134,9.56838909911954,9.61274364264608,9.60697956701895,9.61975759376521,9.60532867640329,9.58085770394092,9.55823251742835,9.54842557859524,9.54958936739802,9.59798474675944,9.61222267549076,9.63447607050376,9.61693519803293,9.61633921139751,9.62919454356929,9.61648796269502,9.63339359773698,9.62424724453453,9.62565301093558,9.61095514404511,9.61371018985943,9.54544200677700,9.54966390902657,9.57242498460457,9.58154644584808,9.57951726257647,9.56187915291083,9.57254158461100,9.55920364037957,9.55024353206533,9.53786471317489,9.58559861696559,9.60414799691162,9.54761507718761,9.53897649951538,9.53565286038059,9.59576725244270,9.60054715743559,9.62880884536173,9.59311153803982,9.60890099608338,9.59768236373645,9.63771945297402,9.65105433677143,9.62501777526744,9.62365287780110,9.59759854219233,9.59231473178019,9.61457145033531,9.60831650077809,9.60316632898282,9.58989810412682,9.58454872999618,9.59838649317397,9.59641590941621,9.57909116033842,9.60142022730989,9.61927159448507,9.61278077935416,9.60034818358986,9.62174920907263,9.64315317213635,9.62605219581428,9.62780534042897,9.60654982696823,9.64098122053539,9.61276793957360,9.62963214199166,9.61648516445387,9.60088492849902,9.60133427719495,9.58489393717587,9.55221664082327,9.59765776414207,9.56537872007175,9.56964134793379,9.56121970107831,9.54305911234261,9.56385899390118,9.58624449440934,9.56355164428333,9.56183684352622,9.56179743902545,9.59691875754349,9.59732337953148,9.65127239505343,9.60024714295145,9.61767001156746,9.61010719635799,9.65013470100598,9.59617539004944,9.59618922746130,9.58021383097265,9.55880182032095,9.59388580248443,9.58467938746219,9.56834447172116,9.60169016900302,9.63332330816940,9.67391608273585,9.67300645910103,9.65621251989741,9.61962807133566,9.62312523699422,9.67459452899471,9.70644090836444,9.67587957595909,9.69158162010410,9.63110617943496,9.61115917526753,9.58772190948104,9.52938447995407,9.69312969785602,9.57999461252111,9.59592433900883,9.60247007845637,9.62127953461131,9.77787932497002,10.1656116982980,10.0731972805020,10.8551160257886,10.4906085218387,11.4391878813967,12.3614047335103,12.5702126969785,12.5354313649684,12.6659919197743,11.6477044582519,11.3337216968293,10.9986518462646,10.7184456109143,10.4708120986877,10.3440806015401,10.4212473052440,13.0109860546950,13.7853659212734,13.2374133867768,12.3278165507054,9.87707415553242,8.97824833508299,8.44700632029370,8.63608995098248,9.25667790725377,9.54377175370645,9.93320406116604,10.0410482416232,9.98702641147338,9.87098119889333,9.84499887894708,9.99901695053467,10.2225085449574,10.6830167124576,10.9837245562949,11.2735942221656,11.3006920119294,11.3145249551850,11.1564033061498,11.1133736121505,10.9433237058063,10.9570574795180,10.9662717053698,11.0144507853056,11.9121152148141,12.4737734580631,13.2316180086476,13.6782192412899,13.6759842433134,13.1653549145957,12.5643191275044,11.5847623130477,11.2697053600533,11.1510663253251,11.1391146128379,11.0386487003517,10.7589352538397,9.87122952874975,9.16572178241420,8.90358671504088,9.31623700150963,9.77208388844191,9.94533664989358,9.34583322183608,7.43990175044180,6.15181890403880,3.86329966283972,2.99041673763339,1.84774614545437,1.30627291420368,1.12913536556586,0.929540074219733,0.875100233695770,1.00432846199324,1.07290018844396,0.120841125697078,-1.44624339847444,-1.63806857157010,-1.09121400070726,-2.07430906595345,-3.31444860309287,-5.11830680858789,-0.115904096762587,15.6669281303528,18.4656249231751,13.8401287543597,12.5265414711327,14.4373448192900,15.8973258586680,14.3364439256000,11.0884952204691,11.0589150547079,12.2420578922850,12.6318704584489,12.8054171180928,12.3987583797697,16.7123094806172,18.1413705895302,12.7601606105034,12.8298540664049,11.3669714532208,12.0253019378505,11.9693520600693,10.6217823474702,10.0624428620492,9.98978452383617,10.1076282927713,10.0163496579991,9.87787266155105,9.76070293487782,9.77828339566580,9.66567391066679,9.65341141078113,9.63466406671065,9.66392826166300,9.70473155936795,9.51985713786618,9.41881289153470,9.40008892129815,9.36535011267018,9.60805523494421,9.66493256147244,9.62478804422797,9.64564792991812,9.62253052747759,9.67316230529243,9.65070423539063,9.64181453458900,9.67816598637421,9.60414396161143,9.69221089768657,9.68920710039837,9.62711798533555,9.62947461755888,9.63954769439685,9.62491773578347,9.59652016885248,9.51993017799567,9.63762659756762,9.60827292397253,9.66614687852124,9.66868621940492,9.57576298332509,9.62182021394603,9.68302085369350,9.64715267373203,9.64694490705772,9.63021851117341,9.67424592318555,9.60701731771112,9.62089377107487,9.59046473294242,9.56697814484134,9.51100610817765,9.55636376521055,9.52119377047086,9.56766946151744,9.55872059480542,9.53379920340481,9.59214872054097,9.67694769090322,9.68768477688123,9.73867048414434,9.80879622586475,9.72295819735357,9.73259182187342,9.77064140872021,9.87312883276215,9.85348313844972,9.54360792934093,9.67836816313689,9.89113039035535,9.86998661958339,10.0861177904110,10.3070751995401,10.3743187376571,10.4580446110638,11.1312567763420,12.6933853170371,13.8891825462662,15.6704916585901,15.9574533459486,14.5347752629829,13.3774416611086,11.2670037483524,10.7715943142307,10.9543059954212,11.5822120656893,19.0179721693998,17.3360949716827,13.9520652218724,10.8454207655882,8.19890819089204,6.58737316460323,6.54593153101941,7.04415130962048,7.26502195995912,7.23070971489708,7.21671815090327,7.22614133776359,7.56958056730667,8.54549282506698,9.31627160792055,9.65816381474017,10.1447149473070,10.4946463767786,11.1194335328807,11.5057433515730,11.8534830035383,11.9127398287505,11.9853997972091,12.0456745876746,12.2896193669542,12.5461534538016,12.7662777661410,13.4246255191845,13.7271085656326,14.0529490385619,14.0368421823913,13.9082106278482,13.6492843510915,12.8741159246473,12.6170466894959,12.6748062340722,12.4658542995411,12.1715952324307,11.4172680394322,10.8319288641431,10.3636558498032,10.0810584041343,9.58670977446196,9.16498798386470,8.38410437280992,7.49830873559968,6.80714817499992,5.24113581937987,4.17322248068874,2.23178750862165,1.22282014361088,-0.189940859792636,-0.815342156892175,-1.61975752097094,-1.98591549458985,-2.34515147454073,-2.48486669256371,-2.41385015649501,-2.18406118248049,-1.49733103210725,-1.09764553684935,-0.888283674195119,-5.83780157245543,-4.78785830018277,-6.05176604418002,-2.30904066615906,9.58142659947422,13.2011861266224,10.3698069793645,9.18207862803767,14.9385216016196,17.9501546094828,17.0280137110867,14.9769118097286,15.7077455894532,16.3890582744592,15.7579373996880,13.2636231849462,12.0519208015543,10.6430003066956,10.6481661795335,11.3566753579305,11.7185978453974,12.1921482020030,11.9813370297302,10.8902806414064,10.6566107814904,11.8341460439729,10.9639099123114,10.2553650179204,10.3112908222533,10.6788224983103,10.5636230723009,9.97145187618516,9.48453221837599,9.79529755547905,9.85098600645336,9.99069639264111,9.81421952538000,9.93558621079056,9.85859899420973,9.78356037016209,9.63690745348683,9.58312998647876,9.61601631520736,9.72973416285122,9.91403297887109,9.65333322249284,9.75492354047267,9.60011674447300,9.63908431328947,9.59426263542466,9.63257250149112,9.68193994335212,9.65073435704288,9.82477170076576,9.75504778576337,9.61589750628294,9.65623094826545,9.61528478887306,9.63260408943362,9.53866396576510,9.50018403068809,9.62464793951690,9.69208023598527,9.60612651318854,9.66433608453253,9.66856841789408,9.57372859267791,9.52869069412040,9.47269048901535,9.58977922401268,9.64315517541218,9.70149805932603,9.71418689324811,9.73428359605500,9.75407856521604,9.64778451448385,9.71511399452524,9.67892406985252,9.78803974885859,9.74902356188695,9.70235476695315,9.70719272777315,9.71907600246737,9.68661243081441,9.73877874581445,10.0437072517559,10.0068614016500,9.51768606402844,9.89124757537488,9.92881638879511,9.94065383759549,10.2414291664320,10.5061127213705,10.3923695791498,10.3247613211258,11.3576159209064,12.8097665426013,13.6652492934164,16.1191212470420,16.8926174008057,14.7505655174296,12.8367243976803,11.8163429814059,11.7380324637871,11.7633642543942,19.4754121176119,16.0103889248325,13.2314399432941,8.63875018363248,5.21709859070433,6.06108370254748,7.67564436714550,7.96883247108182,7.76935099626742,7.62813570678131,7.62571486994356,7.67874004255204,7.71466499834064,7.79227821193253,8.19425990675362,8.90301415306575,9.27985256657400,9.79051702223350,10.1917729434982,10.6126908993750,10.7027260577431,10.6623472541225,10.9986333892636,11.3964040151051,12.2385510865879,12.6498751227618,12.9320528514994,12.9680140442997,12.5023648093545,12.3312068494726,11.9912435252427,11.7381485259814,11.5221380963467,11.5670222557695,11.8296656600256,13.1403180249372,13.5446553046964,12.7033740838483,11.6545439566941,11.0097400144168,10.9686425766842,10.8522564160677,10.6771431861483,10.1482674173370,8.96416699864267,8.45310923388490,7.93162573709976,7.47318981165453,6.57053366794742,6.00234340247379,5.34500903988893,5.00782852228714,4.20165612145550,3.05430927386266,2.28392297609106,1.04886532712999,0.749265408488964,0.574043675294395,0.250651960296673,-0.688251404491909,-1.03648670755732,-4.87712202360056,-5.15104350733701,-4.93318499546755,-5.36047678614019,-6.21273960202865,-9.08866519311008,-0.796104117271107,17.9123247377748,18.9151403858414,15.2749158351441,13.3662273944060,16.0107261598230,17.6129458031271,15.4441039664898,14.0062642127900,13.6157156607554,13.3028699047407,11.1797948150013,10.2104912405659,8.66967580835615,10.6958075984974,16.0857711696847,18.2438686670401,15.4406423669932,11.5123624387276,9.96902863288936,10.7135802268741,11.1636578215121,10.7562751666552,10.3511397544466,10.0587677334654,9.96715516687836,9.95531610061516,9.96210982371620,9.81187251522724,9.73095448609162,9.60096392896992,9.65065306602796,9.68626615901161,9.65472143772087,9.68054572180234,9.66039690607204,9.53483160221055,9.61489111850575,9.61417788276946,9.71427371272444,9.73180329544898,9.74837833214980,9.70659375735457,9.64920553377408,9.68313000058296,9.56893896760884,9.54778705903352,9.54376364861103,9.54379479553006,9.52865046682324,9.60909319248352,9.59605608906439,9.60422389672832,9.60382896541604,9.64536732425921,9.65402292014789,9.63734509288065,9.64683169725314,9.60495386024074,9.58073936546814,9.55227743076564,9.55061420199830,9.51544515801446,9.52655580285992,9.56250378584450,9.54957641274748,9.50419120474548,9.58352109911522,9.57596029115837,9.49235982439493,9.54271995433325,9.60476282352703,9.76960904917975,9.55800700007081,9.56338908905510,9.65048235611877,9.61318494628231,9.67081404588078,9.75733060865477,9.70984038531631,9.74381507571043,9.72124410974013,9.83262295554041,9.92840223448144,9.90080549251276,9.47756846032766,9.85716679859316,9.96602010754264,10.1550215037147,10.2851904454564,10.3767002878750,10.3651351515186,10.4727013047675,11.0542816823014,12.1490158655707,15.1128142683078,16.6277622744876,16.7391128029230,14.9221832941521,12.5910364806177,11.2054358716625,10.7049526765268,12.5909538740992,12.1540893774016,19.8381911902624,14.6222585330229,12.7826436068580,9.20038860716962,6.12154980613397,6.83624075318958,8.29187452395274,8.55740634267295,8.23348532092915,7.89277679206311,7.39068723741525,7.40512241761658,7.73748904930887,8.34944796324651,8.68224009852529,9.18176503668343,9.46150062331943,9.80757818802687,9.95464332027218,9.95259005419599,10.0275540734800,10.1800106139978,10.6051648513163,11.0060726421146,11.9500406752352,12.4595100003441,12.7026577551594,12.4441117546128,12.1306840305941,12.1295241611810,12.3587683473175,12.5442399496140,12.9762863558815,13.0937215487202,12.6758788192596,11.5970335606472,11.3657660261642,11.9631990999922,11.9362076236171,11.3327230793904,10.7921250191397,10.0767945776799,9.74202865486966,9.05039248937115,8.21084350058069,7.72599372855511,6.56879663426503,5.61450590879315,3.83860518840884,3.11927203801661,2.61872653321466,2.69682313415224,2.89058883971985,2.80397958045271,2.34664715847652,1.73822119970919,0.486699013157127,-0.574820854721820,-0.875572336456192,-0.888493972009793,-0.707289009443608,0.246364066852701,-2.99870824281521,-2.90963088186462,-1.64767192038551,-1.87396757144486,-2.59472281046079,-5.18440177922212,-4.28827769275055,12.7152722720140,17.7178787276390,15.7787665271042,11.7947832659530,13.0067426133602,17.4371709481018,17.0732549654774,13.6124430896735,12.2108976769547,9.82180459967583,9.76433555431417,19.3066798582599,18.3169840915215,12.6194598553952,12.9525902701092,10.8398905843982,11.7242132865993,10.7269898533814,9.83357642845530,9.80766076700694,9.71105730929578,9.75571582011084,9.86787384814601,9.80231764129812,9.74813077902675,9.64904671639419,9.60180922630415,9.67811013432386,9.61432126716695,9.66058491346552,9.60260609232997,9.68990234910519,9.63862016025572,9.70000111936816,9.70472133134687,9.59289617545059,9.62908413251933,9.59162104397763,9.62101710080731,9.55106399275225,9.61030890443431,9.62828527865441,9.62936752432047,9.58463607067937,9.58876491375266,9.62605032637324,9.56107654197024,9.60432286517922,9.65965575419102,9.63431195615109,9.63172013538310,9.63443408789675,9.62482294230917,9.64964353276536,9.58831681631576,9.58404848098803,9.57138562571613,9.61106242103586,9.61614623108159,9.60110837558481,9.59991355383536,9.55388655228536,9.57378692548756,9.59863234099634,9.57747359779234,9.55605015063715,9.52670738748445,9.51312295696710,9.55171572124722,9.43949974290760,9.38264054612294,9.45619157594385,9.61408736019375,9.45642672153964,9.63981603158496,9.69410225706929,9.73812760635200,9.75440816219251,9.69679217081127,9.56285321443306,9.90494839222453,9.70646921313965,10.0990423993301,9.92637683812374,10.0594826739902,10.0678218881909,10.0107926837442,10.1774869531557,10.0894298384230,10.2032359282966,10.3581079575609,10.3064620146968,12.4784754897514,16.3294899180382,17.8509311876980,17.2596837743743,15.3326810131141,11.9226275745113,10.5603273954035,9.79794174817108,11.1658555302783,13.5063678094769,21.7286404413784,14.2933581444057,12.6573898340541,9.35221546212535,6.75670016891541,7.54084433901018,8.87572728999062,8.70743306811947,7.51314964255855,7.08889117409172,6.94226904914507,7.21254132236168,7.83777995934186,8.26924162044507,8.93581679772697,9.34271930052296,9.80557192764399,10.1521056536764,10.4178516751069,10.9583141003267,11.3038652054296,11.6566877204106,11.9684811412102,12.5726623884369,12.8324158572510,13.3125569570762,13.5186933245131,13.6567658998690,13.2640773894187,12.9209888779996,12.4770860181116,12.2739567493906,12.4563484581104,12.4745113815321,12.3862048446107,12.3661708591721,12.0888531441107,11.5805801191251,10.7565946215645,10.0657642914669,9.32741012266575,7.56112227174756,6.70148539097215,5.85556228131750,5.70005101897708,5.58599230783909,5.14023621519225,3.91300486477866,2.89967780534089,1.05325158109387,-0.504242843659594,-1.12969515983534,-1.63470960687298,-1.66073566032860,-1.56407979298315,-1.45484817441469,-1.12864184866294,-0.788079260676014,-0.136107708276393,0.304243645216384,-4.20889784886602,-4.56570910560191,-5.02863085774720,-6.65352790847475,-7.55030221377874,5.62254847192219,12.8541012477434,16.3927022995367,13.1604843290852,10.8176264431394,12.4353034907036,15.1678814931354,15.3268564267925,14.9005450726865,14.0093443454196,13.0761586214085,11.0427548111946,10.3968570597837,15.7893698647892,16.7963374630932,14.6341980975892,13.4028576204100,10.0674296483262,10.4035595712994,10.6740027847445,10.2575615636812,10.1310029963520,9.91018826566471,9.86578500214967,9.80672137176990,9.86313638863775,9.66971001942441,9.72649259291474,9.59650348811557,9.71993759530082,9.64097041989026,9.66535972139942,9.62180496196733,9.56247171793253,9.50406247047610,9.58875733536046,9.70723401811562,9.65958518210328,9.72929417040444,9.73013269701821,9.66589389796735,9.67095782717395,9.70877446276023,9.58108232968835,9.51963424226922,9.56692501595690,9.56399221027306,9.54761912147542,9.54843737268536,9.56412813855441,9.60082707717559,9.61701863866188,9.58703782375728,9.58385297322537,9.55000125678162,9.58284958470404,9.57359715493277,9.60953192157324,9.54461047688815,9.58522579155952,9.57266919146758,9.57637275920707,9.48755553667645,9.73144404978769,9.52641301209532,9.57733701750228,9.58060212889038,9.56919014920744,9.57989281165916,9.58662899923656,9.58919502932280,9.61889098202511,9.68218976932238,9.60536356823274,9.63096543852705,9.69530851185313,9.72225448022764,9.76034518928609,9.85609424025330,9.96986566149290,9.98411748766873,9.95389768928413,9.43627189099086,9.77582982383883,9.95846268459941,10.1887672711506,10.3512196451126,10.2435283601730,10.2980743098503,10.3821623251668,11.6932513664692,13.1814290198151,16.1633802879871,16.3797837364968,15.4006426059913,14.9653195553058,12.9720320311592,10.3891771617621,9.67739175044440,9.04963859083617,9.41517286065593,21.5685575289745,17.7385482300375,14.3418694784318,13.5819696827804,10.8885240203017,6.62892498191674,5.73445268391919,5.13447615111593,5.12929182570845,5.47959885993115,5.75731710270326,6.54377319069869,7.08492827883806,8.21698536728406,8.84763711838551,9.07938300112492,9.32076983407869,9.45541783687102,9.61157011367157,9.73943748706588,9.93418694194628,10.3188484354278,10.6116748878778,11.3223176280098,11.8548419138715,12.7877970915974,13.1454936389484,13.5692185921841,13.7048032934995,14.1650035939165,14.2999849246957,14.0489883485833,13.3664781191331,12.7977941539694,12.0989656682266,11.7520834383793,11.1850997353567,10.7125034131489,10.1043178730872,10.0566746282007,9.82496181756264,9.52717021616434,9.38660248958582,8.97373819067447,8.36188728036188,6.63667814530755,4.32386611764923,3.02349569016716,0.909746942971111,-0.0291187024636437,-1.21276262895654,-1.95393199540307,-3.57805929324736,-4.50347360396775,-5.88418256949480,-6.64498535848544,-6.96135749987655,-7.73025890741349,-7.77634752537985,-9.63998801786691,-10.9119962119531,-14.0984798941144,4.93518336964265,15.9100478175602,17.7775025663333,16.5633359600582,9.49863547050186,11.9086756602836,17.6253286124490,17.2440933128475,13.9666657693961,12.7134673385448,11.0754374809613,16.8130391696244,14.3346890677908,16.2349900958188,13.7745834631245,10.8815853063387,10.6755205334182,10.3980068393339,10.2488799709551,10.1627410439987,9.97074108242585,9.84804440168605,9.78736671354854,9.77937384282621,9.74943911063679,9.72998689040197,9.56821765152780,9.41517296058961,9.49554747819314,9.61438653297365,9.73472876241006,9.68848075121419,9.65079970106285,9.67710255261974,9.71222705048070,9.71925734482595,9.63030953860945,9.62474194890603,9.69698558952634,9.60314704834123,9.61826806629843,9.65478868700742,9.62834429952491,9.59443823049299,9.63853043923345,9.63578925567821,9.52562150529671,9.55460035671265,9.59064482417061,9.54010195222578,9.59434503099152,9.61473562261688,9.61808322751135,9.58967252778048,9.62184268932942,9.64896845492169,9.64484373985487,9.66443827277425,9.65788598422079,9.66343273116880,9.61443848420073,9.57606947528371,9.59639540439535,9.59547420815421,9.56760930182454,9.50517048403434,9.48328002289649,9.62018433664543,9.49833066781437,9.47039212839554,9.61741483955509,9.64671131717382,9.72470538413915,9.69953308654935,9.70870342831605,9.71666936791517,9.71841245538700,9.69043334786025,9.65862937191906,9.98751087149335,9.58575733318772,9.65604910528393,9.69915394821054,9.98536164888956,10.0519197918020,10.0917441562963,10.1157216061137,10.1426208505233,10.3039822999105,10.3165012962783,10.8669505147790,11.2798392938510,15.0267877680735,16.0657247746584,16.8668755047032,16.2054931228601,13.6159762117596,11.8524093601847,9.29976332662496,9.96897485634429,10.8598208550090,21.0184961878790,20.6393927390964,13.0023874447218,12.5935027234392,9.94082270032241,7.26213423557461,6.03844335931072,6.11436324273806,6.16864437287865,6.48309054136429,6.78576442144056,7.27849893655280,7.66172875072602,8.26048338926277,8.89767228888298,9.25664973189183,9.67078190995610,9.90427379476196,10.2736747513199,10.5392176828534,10.8082610805986,10.8730497546866,10.7081720867535,10.9330426334295,11.1701695203248,11.6575624846554,11.8260909607315,12.4200923257686,12.7891093035460,13.4525451760571,13.3853883864374,13.1602608643828,12.5189117977549,12.2194651497197,11.9085533679678,11.7764765126288,11.8349939930351,11.8398845164417,11.5703458910263,11.4562252486407,11.0164843009987,10.4782262746104,10.0515224826988,9.39956730191938,8.75937062040661,7.69372658458938,6.98417597019856,5.98574775533620,5.44279237843576,4.51165194328365,3.83647235978455,2.55763892451079,1.43737012319188,0.864138662032795,-0.119641681523448,-0.731774115228488,-1.95627294049697,-2.54950356903921,-4.19858140207807,-5.23502259872921,-5.43201638983866,-6.72337266417263,-7.54121374864150,-10.7864530865733,-13.7807892387144,-12.6396023434708,2.31828401519801,16.7409484459272,16.5480671396148,12.3189343008807,9.81502998597391,14.2552698981312,14.6359870895055,13.0518682534417,11.8876044047218,11.7438929218138,10.3024477454213,12.9242909462613,18.1178118391170,18.1990647489456,11.4947554981631,10.6406874945975,11.0987987635654,11.0798569427600,10.8301808228135,9.90016968250141,9.92659483877015,9.87695456141652,9.84189169765319,9.87817883233262,9.78060600801109,9.68335618083161,9.75917889213567,9.60949804200869,9.61908830466407,9.70423304600640,9.61299021067892,9.65751815395574,9.66046397181616,9.72217436288750,9.66466074900924,9.72488335399229,9.61620843005346,9.64029766532532,9.63070840358263,9.68137315857524,9.53236905587174,9.61047302971688,9.64309835209745,9.54297568160999,9.57262492212769,9.53317836335721,9.60229012928294,9.58741378318353,9.56993622609791,9.59554755334247,9.53842462557308,9.59305580250650,9.63842465360019,9.59219254426481,9.59771816764445,9.56710364573559,9.64014944152581,9.60704401067816,9.60517816059856,9.59774013886673,9.61719196224484,9.59820349960620,9.60591659475239,9.61583590069308,9.61288732029237,9.55240480515865,9.60102576394656,9.66993381932984,9.69911009927743,9.72011641564610,9.75646090610748,9.75587760771600,9.69279694573763,9.68864423357475,9.75796270400564,9.71594858760524,10.0799918024654,9.93363235088384,10.0172410102617,9.63623566928447,9.86585146231467,10.0747533171769,10.1432314967705,10.5457401051591,10.4791487859430,10.2784475204802,10.4159736710423,12.2834735006913,12.8751706537937,14.7095059283158,16.3141481749531,17.1320927415358,13.5290017003219,11.9358552413501,11.0992937343367,11.0027771636656,11.0287005530671,18.1569106448094,16.2182059404303,13.3075511205219,11.1137046816770,4.94923192723387,4.62232950773499,5.96233232136887,6.67327020567788,7.41974973993900,7.38423970487927,7.17595703539331,7.28664181357096,7.57746144215554,8.03078065017721,8.35287744022328,8.88877583930081,9.12263304231492,9.37334272470105,9.68537106441210,9.84488939410726,10.2010699456169,10.7118980397491,12.1227394896965,12.8729708523183,13.8760058152891,14.0807150891988,14.3511079655390,14.1107908126698,13.6767892457715,13.0843179993134,12.9153660084604,12.7838780094758,12.7337520649082,12.9134228202828,12.6967967903940,11.7396826515313,10.4904708854211,9.95195400772644,9.25526520374107,8.98569989427130,8.91627383772167,9.13572974899649,10.0041357806323,10.2929041256659,10.6865701638579,10.4757703932603,10.1406613942017,8.88208842777483,7.92148959788122,6.65347110653081,6.06550062353506,4.67744547557578,3.64889870306120,1.75885562030615,0.359761044545494,-0.134422201894498,-0.511168169120659,-0.628748786650487,-0.924380451672646,-0.948141537483922,-0.437794099754003,-2.00593666029288,-4.49935982595537,-5.53964433857254,-8.49242039494768,-15.0066266820624,-18.2338678542986,0.862424230999561,17.1764700532483,16.7464755269022,17.4484724958152,15.0804818965175,17.5248471521774,18.2810535461664,13.8245302791615,12.5401902552374,9.59761457922323,8.85325590222266,9.31052232002887,13.0413406301358,17.4863296301520,18.1060149775339,12.0652964886541,10.8581890703151,10.3355499075818,10.7390313836195,10.4107776164919,9.91497710846394,10.1736189829748,10.0321226918805,10.0082811560437,9.93616727324170,9.87804420083630,9.87251017746537,9.79971213656359,9.70745997877044,9.72013292422104,9.66326358950085,9.61097887009466,9.66340455377227,9.75452415226243,9.78757082927009,9.76835222214495,9.73195211904889,9.73553118170994,9.63890928722885,9.57641106275509,9.57331067470708,9.59955873178027,9.57081153123684,9.65131521507003,9.61921236170250,9.58496358924682,9.55519220934908,9.54497591911095,9.53487551075772,9.57353547696200,9.55363650523876,9.55663964953176,9.60973894293020,9.66186861429922,9.59264407420544,9.67499795613281,9.59540665832476,9.59431780715474,9.60755809004064,9.59864061099964,9.56406277285844,9.56709708166297,9.54850689936092,9.58453732278472,9.59197204147263,9.58925444825582,9.60061702109338,9.63361676353291,9.74621675350941,9.65641703034301,9.62799157739576,9.68203639703846,9.61875746384516,9.61009347040999,9.61588989575920,9.75468661880023,9.82921264792111,9.84653853278019,9.65896902331231,9.70085971276812,9.76595935676874,9.99177648686191,10.0472153944500,10.1737215925990,10.1401738230035,10.1782185196542,10.4947811367837,10.5690615236213,12.3355786120207,14.1809506516177,16.5347163099169,17.4968099145309,16.2386591300415,14.2812287797204,11.0599563880126,9.44595229655117,10.0034754562057,10.8404989555951,18.9366494946621,17.2228629393363,14.2452320717114,13.0479809020691,10.2582812864816,6.32351972119028,6.71694918720898,7.29910988505601,8.04102410295475,7.93643523079796,7.09640956983667,6.72536838014674,6.23758072686186,6.31075822476907,6.74631876026065,7.58145929962720,8.15411672698695,9.11703414536027,9.60012324966754,10.2691935224437,10.6612541854827,11.3039561524642,11.6385239137589,12.1053975697267,12.3133258908739,12.1410238566556,11.8520965407132,11.9103942927774,12.1748178671056,12.2314020854930,12.5694122435498,13.2655413292763,13.6260067466458,13.5995612248839,13.0850244742232,11.9226930200427,11.3952129420261,10.7428833893116,10.5398847551593,10.8523241181539,11.3812604834819,11.3264516025130,10.9584678885086,10.4962821178182,9.51812776848474,8.82323377010479,7.14839494350415,6.35019834205791,5.49390045123067,4.73385541513401,4.19401327149954,3.36752118210098,2.95718626617272,2.28207590236054,1.77344213283517,0.374170247863226,-0.299024483428645,-0.783886888884883,-0.883813839291429,-1.07119995941159,-4.45026489584424,-5.41668882332111,-4.96550403034857,-4.77421629503436,-7.17710828094324,-9.43290806329121,-14.5724056096607,-8.65970161023644,18.0752309840479,17.3024752559736,13.4823079243343,13.4858436653960,17.4731862420056,17.2082665193767,13.9583317900194,10.4293501274295,9.45131953659436,13.7822148150084,16.9749580598486,18.1730809050630,12.8886331870560,12.1124086047858,11.5019046409862,11.4730123402677,10.5877006127794,10.0796991118499,9.89893162020627,9.93555249872087,9.92131313072151,9.82649961239516,9.73013586824039,9.69630540855861,9.69018725094614,9.62636609866428,9.52332254086167,9.60914423273231,9.67598171250032,9.69086220803356,9.69900564386606,9.66849440506639,9.58279711394259,9.57644871176548,9.65072527351385,9.64189689641889,9.70201565028968,9.66625019988218,9.66486328931351,9.73679951480978,9.69472764207132,9.63118176843701,9.63700283730687,9.61553370906240,9.62758507583834,9.58051705580013,9.54818864161725,9.58011683466771,9.62153658733893,9.62361262635309,9.62930377277675,9.63168794111288,9.60822859794601,9.65652793853900,9.63247547742026,9.64859135559254,9.62885600311032,9.61353245749434,9.61978530753282,9.58962513323747,9.63224191414908,9.58563233940854,9.57348991421489,9.57859184841580,9.58122546425202,9.58224221978737,9.57035577464455,9.65845751877863,9.62420493523011,9.64091209372981,9.60596831322917,9.73198129122519,9.85004241605834,9.75526542616689,9.61653742683644,9.95514422921993,9.89694150109914,10.0593326452102,9.81991323223497,9.73724206703790,10.0571029418672,10.2998321022089,10.1859935140306,10.3594398312113,10.3409408966699,10.3965923326055,10.6842581548885,11.3883065383301,15.7250262818644,17.5421548397987,17.6379478738299,15.1217415404448,12.6434605825485,10.3082880852309,9.90800558650118,11.0257495566191,10.9877627403083,20.4626820306550,16.2444066717932,13.4354821504780,7.15322895353764,5.82021197004727,6.43858983441788,7.06119111275763,7.61404143474613,7.45924430135864,6.85440907352538,6.61274607374475,6.50105717489111,6.76232154715423,7.06356571933179,7.77640345723481,8.24340426880794,8.88514776705670,9.34930645890760,10.1219563951753,10.9924360767102,11.3781069743545,11.8606584571976,12.1178792025033,11.9842995167885,11.8380200272814,11.6737455722395,11.7042968787413,11.7824271929125,12.0451555907355,12.1670522058478,12.4292618927477,12.3913433074071,12.1661620872361,11.9331116984145,12.9366323110610,13.5018520276531,14.1811339853374,13.5439071043219,12.7505875420437,10.9990749587472,10.1374257411906,9.77637484186714,10.1048306982761,11.3995514159643,11.9416392366389,11.6164272044555,9.72993136217403,8.14888751172174,5.00717032196223,3.69455748777053,2.07884343871256,1.64236683874544,1.45588884509528,0.401350810039419,-0.421973511442324,-1.92483765508879,-2.51085602853074,-3.15929038333779,-3.22978892368347,-3.03255768187112,-2.90788855267583,-2.59137472473390,-5.33763547888888,-6.82888769025423,-6.92296514568428,-8.57909193692455,2.47820372637809,8.99775862036639,15.5220179965943,14.1240096636658,13.0363486130333,14.8923696445998,17.4330555564705,15.7233145686689,14.4463647227033,11.8750586441801,10.6665469005711,9.47291422393710,9.22761816813360,9.34022210338091,9.64580019417852,9.79829899648186,20.4398642616522,16.5572123174266,12.0528418991850,10.3978985642054,9.97882764405647,10.8635639435388,10.1060561905931,9.82793714383901,9.91760427531712,10.0195897082580,9.87056674854468,9.86897133756649,9.89677719074291,9.68515176178872,9.84075839488277,9.71412964160814,9.79312566705898,9.73197664882568,9.79213984731364,9.69770162668524,9.72457973259874,9.70316522533136,9.69808903556974,9.67337244396119,9.70293091926051,9.68555746221774,9.61287586523408,9.67500159351505,9.63246609271019,9.63485392552368,9.60366461842778,9.57948995502989,9.53337264556810,9.60985177246972,9.64473107240269,9.60894225253035,9.63269403265440,9.68847989462682,9.66106047384453,9.66033711452800,9.67451286107396,9.68152862532439,9.68157881136966,9.65240256252437,9.63403552969741,9.63455246034073,9.65005753941547,9.62388196434258,9.64339358119675,9.61692713028034,9.64878272372229,9.63211314162258,9.66581203093159,9.70436427867347,9.65351667186820,9.64399564536302,9.65427404304613,9.64501696660052,9.63156488476438,9.60449586506745,9.59368678855668,9.66283663965683,9.74733290372288,9.78416823893703,9.61453016157073,9.77357982595155,9.81078628049188,9.81161368162938,10.1267859042551,10.3741412305796,10.1906385198130,10.1418538795849,10.1872326550739,10.6701112312622,11.8562773189345,13.7260582787032,16.3001351245838,16.1992082854974,15.3757126277332,12.3633348517534,10.8384178104862,9.32080375722312,8.78642518089252,9.05103030512243,9.51076148722848,22.3960802488210,19.2103943403742,14.9932873886604,10.9965696405186,8.39724017410848,6.73996203842220,6.61567219928322,6.25240786032754,5.87565231420651,5.06671001060012,4.87841663807651,4.77995585450423,5.27940267438164,5.68762727955822,6.47192566822332,6.94897919202999,7.94274727180864,8.48633107812472,9.28926853405454,9.86691347002740,10.0446488059245,10.0698081041830,10.2089564799267,10.5362657056314,10.6868136897276,10.6986902564822,10.6340589164401,10.6378072365820,10.8268524000690,11.0141691790806,11.4648516188859,11.5550755409172,11.9730883163051,11.9052019091125,11.1834934715914,10.6541814821860,9.71975486227305,8.92998585551043,8.61663657917668,8.48536620407600,8.29282337055901,7.43246738848126,6.80184754509704,6.35088612201323,6.28651315856590,6.78521878077245,7.33674057443775,7.35843777383060,7.09335356031026,6.65072911630986,5.97087431915367,5.65063809968841,5.48433671667601,5.68204370132972,6.50977594233483,6.60880388186896,6.38181610390031,6.01471559472680,5.63811631684696,5.59900017656188,5.76599010753595,6.24752600230960,4.66988870675165,5.18113970365131,5.45093156083196,5.37741911382268,5.24322716703115,5.05768800513260,5.11138025018308,4.80949731065143,4.39209720551040,3.19808027493707,2.27799519838004,4.53008752737396,12.9778409206415,13.4757286411644,9.43419509188449,7.92854366331096,9.40698450694604,10.9132549439086,14.4787104944813,19.0257195426505,12.5682342365135,10.4988350408483,10.5399187244676,9.31266477185475,10.0240447549309,10.2987327362244,10.0536335467387,10.1732615842730,10.0907010212740,9.90927000373763,10.0673697675822,9.79178864898440,9.91225722903783,9.94390690703353,9.78818616089702,9.87911243446369,9.73418628113728,9.76011684933041,9.75866778292367,9.74576116596292,9.69777077045882,9.65025501902796,9.67045500081539,9.70317248545730,9.68114108583195,9.68002184252458,9.65868189800576,9.65167965001649,9.64544073982418,9.63592063824076,9.69959797801450,9.69551534436102,9.66977489835361,9.65324637069534,9.65248090287562,9.65077314977248,9.64618659908510,9.66143428091159,9.65500098881522,9.62879416199718,9.63641713596525,9.63032324010373,9.62028720409441,9.61300768393291,9.63018809551408,9.60284291443309,9.62747807845738,9.63248877922710,9.60860434949184,9.62287113239867,9.61982787325703,9.60622550622793,9.60800633753029,9.61295853505023,9.63397568768850,9.63619414865856,9.64997754051388,9.60626151472637,9.59608354611547,9.58907082370321,9.59832005319953,9.61824838672628,9.66134296629304,9.67024582363528,9.66155854795529,9.62572849144580,9.67669378332032,9.65209447807560,9.65278411180415,9.66029706740679,9.67890583395088,9.64837577231666,9.65810888846884,9.62403129543746,9.65492321314707,9.63257693684171,9.67684497293328,9.70319797602740,9.68150629165081,9.58754943418759,9.59099572405157,9.59931249556633,9.56046317921457,9.61084987501661,9.56295939240691,9.51888611299105,9.54963763432017,9.54584353061178,9.60989799761905,9.63086888686406,9.62594107868152,9.60221649598194,9.54086087762113,9.57037149957458,9.53148797461002,9.58041676341719,9.62289977631684,9.60436887136889,9.59348599500913,9.62829763167082,9.60500457044894,9.62442840130708,9.59818651505309,9.56238760143099,9.58503869201602,9.58059510671248,9.61191988152974,9.58866154006436,9.60132606251810,9.56700314030813,9.60289087444344,9.62229853646114,9.60534273501911,9.59549371889631,9.59021708672641,9.57435071109771,9.56077952323421,9.58064447275272,9.58408500096395,9.59882815400807,9.62036657020693,9.60675697439643,9.58881948752294,9.57557868377730,9.59129337781794,9.59864564426683,9.61462566075402,9.62453480029197,9.61353721602915,9.58817630255355,9.59800080376899,9.61786076880095,9.64126211078478,9.61812131323579,9.57445207506282,9.59518064458365,9.61966467399204,9.59872815657610,9.57308321538154,9.61579625688724,9.61065695523409,9.63423354851796,9.60512687791720,9.61397034482794,9.58630719253388,9.57998456475941,9.56463306415072,9.60309741837372,9.61534085722588,9.62134823338530,9.63228089263863,9.60825524907370,9.60623703488156,9.60751137299081,9.63640951476876,9.61001608591216,9.59147670012742,9.57676456233073,9.59988559005227,9.60881121782517,9.62701216717738,9.64004788335107,9.59210846452040,9.61386312640726,9.60627377143207,9.60664676475885,9.59685134775755,9.59482478258904,9.60294592280391,9.60833461043398,9.62038625846329,9.60567602758073,9.61653656523463,9.60794193333381,9.59555080497946,9.63373209391941,9.61114350894860,9.61270124644421,9.60128803560373,9.61506990319990,9.62441356405748,9.65845530175015,9.60773422598223,9.57675968580340,9.62175028697919,9.60838062638803,9.63324556919556,9.60025002843937,9.63004276057087,9.62289258657138,9.58352839738057,9.60798931891105,9.60923643662721,9.60841315209000,9.61803639025461,9.61336126818632,9.63655056177223,9.61807208153858,9.60682841397190,9.60431824040938,9.62320875678438,9.62077009579469,9.59581304318622,9.60765800200886,9.63034917928291,9.60601535187821,9.60950964365872,9.58966553422002,9.62825307357549,9.62152892709100,9.66076359264437,9.62389958573189,9.59858733859461,9.59937411706769,9.61716184393114,9.60676743455405,9.61105241724545,9.59946844036250,9.61614642965184,9.60526745785341,9.63756759823129,9.59574604440147,9.61339629138621,9.61502900254685,9.63483963543708,9.62696883383062,9.63769489209181,9.60701768393104,9.58147095575213,9.60004444438604,9.59399854727870,9.59931694910582,9.61122379870409,9.59915007053294,9.59602648442861,9.59464574430669,9.60170530276250,9.57726549085940,9.60216973270911,9.59268539569137,9.63827301978550,9.64380559930042,9.65533577322987,9.61256570883175,9.62620345384176,9.62583208088379,9.62440217798295,9.63236738603121,9.62128658330106,9.62541537151665,9.62049055680828,9.61352249474619,9.59920455891109,9.58074260730912,9.60249423841879,9.59769099637619,9.59623570491484,9.62941915011763,9.60143836598385,9.59687136474655,9.58198071242879,9.61668473145557,9.61558682482613,9.61451534847059,9.60092223539428,9.57817341236645,9.58546154426887,9.58903956612981,9.61870548161063,9.60232436796459,9.62558126433517,9.65672713337584,9.62559969171334,9.60811646622186,9.59652692264079,9.62398593768482,9.63019541159162,9.59488548822873,9.61130653200322,9.62573655008990,9.61030686729460,9.61316316405731,9.61480950154404,9.59181753691185,9.59279592472083,9.62673246805421,9.61241737569714,9.58960639191298,9.60411887886034,9.63059883799587,9.59931669586680,9.62070896558661,9.61122180291073,9.59816259954149,9.60386051583283,9.61433141886022,9.64326600763138,9.60182405288964,9.61719623232909,9.61350649024833,9.61245339868642,9.61807463153931,9.62428716786269,9.59725044206667,9.59835519579521,9.61811363617044,9.63529180425693,9.59820499514935,9.62811416074178,9.61188922589401,9.58883902106721,9.58743446564237,9.59182196975637,9.57257186492348,9.59248604198834,9.58968965755031,9.59190009348135,9.63989359600889,9.59743700681898,9.59810411906030,9.58392634695029,9.62234887172295,9.61851781131189,9.60760419651177,9.58806692928990,9.59698665203547,9.60775265884865,9.62995236553227,9.63286631051012,9.56806851967885,9.58613632097225,9.61893392479641,9.60178576210416,9.62679550788622,9.59892164351810,9.59508434430617,9.61440924230766];

%calculate error（Conservative calibration data subtract data from navigation coordinate system.）
tt(405) = acc_np(405)-0.8751
tt(406) = acc_np( 406)-0.8751
tt(410) = acc_np( 410)+1.638
tt(529:531) = acc_np( 529:531)-7.268
tt(577:581) = acc_np( 577:581)+2.414
tt(583) = acc_np( 583)+5.838
tt(417:429) = acc_np( 417:429)-18.14
tt(433:434) = acc_np( 433:434)-11.37
tt(514:519) = acc_np( 514:519)-15.96
tt(529:531) = acc_np( 529:531)-7.265
tt(576:581) = acc_np( 576:581)+2.345
tt(588:589) = acc_np( 588:589)-13.2
tt(593:594) = acc_np( 593:594)-16.39
tt(682:686) = acc_np( 682:686)-16.89
tt(695:700) = acc_np( 695:700)-7.969
tt(715:721) = acc_np( 715:721)-12.937
tt(750) = acc_np( 750)+5.151
tt(767:769) = acc_np( 767:769)-17.61
tt(852:857) = acc_np( 852:857)-16.74
tt(863:865) = acc_np( 863:865)-7.391
tt(884:889) = acc_np( 884:889)-12.7
tt(895:897) = acc_np( 895:897)-11.37
tt(909:910) = acc_np( 909:910)-2.619
tt(918:919) = acc_np( 918:919)+0.8885
tt(921:924) = acc_np( 921:924)+2.999
tt(929:931) = acc_np( 929:931)-17.72
tt(941) = acc_np( 941)-12.62
tt(943) = acc_np( 943)-10.84
tt(1022:1028) = acc_np( 1022:1028)-17.85
tt(1034:1037) = acc_np( 1034:1037)-6.757
tt(1061:1062) = acc_np( 1061:1062)-12.27
tt(1083:1088) = acc_np( 1083:1088)+1.661
tt(1097:1107) = acc_np( 1097:1107)-16.39
tt(1188:1196) = acc_np( 1188:1196)-16.38
tt(1260:1269) = acc_np( 1260:1269)-17.78
tt(1352:1357) = acc_np( 1352:1357)-16.87
tt(1380) = acc_np( 1380)-10.93
tt(1427:1437) = acc_np( 1427:1437)-16.74
tt(1440:1442) = acc_np( 1440:1442)-10.64
tt(1516:1520) = acc_np( 1516:1520)-17.13

tt(1561:1568) = acc_np( 1561:1568)-8.883

tt(1581) = acc_np( 1581)+0.9481

tt(1590:1594) = acc_np( 1590:1594)-17.18

tt(1595:1602) = acc_np( 1595:1602)-18.11

tt(1680:1685) = acc_np( 1680:1685)-17.5

tt(1692:1697) = acc_np( 1692:1697)-6.324

tt(1710:1718) = acc_np( 1710:1718)-12.31

tt(1722:1729) = acc_np( 1722:1729)-11.4

tt(1748:1749) = acc_np( 1748:1749)+5.417

tt(1755:1765) = acc_np( 1755:1765)-18.08

tt(1845:1851) = acc_np( 1845:1851)-17.64

tt(1856:1861) = acc_np( 1856:1861)-6.501

tt(1874:1880) = acc_np( 1874:1880)-12.12

tt(1882:1886) = acc_np( 1882:1886)-12.43

tt(1888:1894) = acc_np( 1888:1894)-11.94

tt(1920:1921) = acc_np( 1920:1921)-15.52


tt(1924:1932) = acc_np( 1924:1932)-17.43

tt(2011:2017) = acc_np( 2011:2017)-16.2

tt(2062:2067) = acc_np( 2062:2067)-6.351

tt(2071:2080) = acc_np( 2071:2080)-5.484

tt(2081:2088) = acc_np( 2081:2088)-4.67

tt(2094:2098) = acc_np( 2094:2098)-13.48
tt(2098:2436) = 0;
%% main loop
for t = 2:datasize
    dt = timestamp(t) - timestamp(t-1); %translate time
    
    % first phase:gyro acc Remove bias
    gyro_s1 = gyro_s(:,t) - delta_x(4:6);
    
    
    % second phase:Angular rate anti symmetric matrix角速率反对称矩阵
    delta_omiga = [0              -gyro_s1(3)     gyro_s1(2);
                   gyro_s1(3)     0               -gyro_s1(1);
                  -gyro_s1(2)   gyro_s1(1)     0];
    
    % 方向转换矩阵的计算 
    % calculate the direction transition matrix
    C = C_pre*(2*eye(3)+(delta_omiga*dt))/(2*eye(3)-(delta_omiga*dt));
    
    %更新方向角
    % update direction angle
    pitch = -asin(C(3,1));
    roll = atan(C(3,2)/C(3,3));
    yaw = atan(C(2,1)/C(1,1));
   
    %third phase:加速度转换框架
    acc_n(:,t) = 0.5*(C + C_pre)*(acc_s(:,t)-delta_x(13:15));
    
     %%micro gait--------------------------------------------
  if t>100%To judge whether to perform the calibration of the micro gait
    K = (P*(H3)')/((H3)*P*(H3)' + R2); %
        
        m = [tt(:,t)];% error observation matrix
        
        delta_x = delta_x + K*(m - H3*delta_x);
        
     
        P = (eye(15) - K*H3)*P;
        
          acc_n(:,t)=acc_n(:,t) - delta_x(13:15);
        
        %recovery error state恢复误差状态
        delta_x(13:15) = zeros(3,1);
    %%--------------------------------------------------------
  end 
    %fourth phase:get velocity and position
    vel_n(:,t) = vel_n(:,t-1) + (acc_n(:,t) - [0; 0; g] )*dt;
    pos_n(:,t) = pos_n(:,t-1) + vel_n(:,t)*dt;
    
   
    S = [0             -acc_n(3)   acc_n(2);
         acc_n(3)       0           -acc_n(1);
        -acc_n(2)       acc_n(1)       0];
    
    % % state transition matrix状态转移矩阵，
    F = [eye(3)        dt*C    zeros(3)  zeros(3)   zeros(3);
        zeros(3)      eye(3)        zeros(3)  zeros(3)   zeros(3);
        zeros(3)      zeros(3)     eye(3)     dt*eye(3) zeros(3)
        -dt*S          zeros(3)     zeros(3)   eye(3)     dt*C
        zeros(3)      zeros(3)     zeros(3)   zeros(3)  eye(3)];
    
    % % prediction预测
    delta_x = F*delta_x;
    P = F*P*F' + Q;
  
    
    %%HDR
   
    ret_yaw = HDR(yaw, heading,t);
    
    if(abs(ret_yaw) < yaw_threshold)
        delta_yaw_hdr = ret_yaw;
    else
        delta_yaw_hdr = 0;
    end
    
    % judge stance
    if(isStance(t) == 1)
        K = (P*(H)')/((H)*P*(H)' + R); 
        
        m = [delta_yaw_hdr;
            ZARU(gyro_s(:,t));
            (vel_n(:,t) - [0 0 0]')];
        
        delta_x = delta_x + K*(m - H*delta_x);
        
        % % updated noise covariance matrix
        P = (eye(15) - K*H)*P;
        
        %%更新姿态 
		%update attitude
        ang_matrix = -[0            -delta_x(3)    delta_x(2);
            delta_x(3)         0         -delta_x(1);
            -delta_x(2)  delta_x(1)         0];
        
        C = (2*eye(3)+(ang_matrix))/(2*eye(3)-(ang_matrix))*C;
        
        %fifth phase:% calibration
        vel_n(:,t)=vel_n(:,t) - delta_x(10:12);
        pos_n(:,t)=pos_n(:,t) - delta_x(7:9);
        
        %% recovery error state恢复误差状态
        delta_x(1:3) = zeros(3,1);
        delta_x(7:9) = zeros(3,1);
        delta_x(10:12) = zeros(3,1);
        
    end
    
    
    heading(t) = yaw; %保存yaw角Save yaw angle
    C_pre = C; % 保存方向 save direction data
    distance(1,t) = distance(1,t-1) + sqrt((pos_n(1,t)-pos_n(1,t-1))^2 + (pos_n(2,t)-pos_n(2,t-1))^2); % 计算距离 calculate distance
end

%绘制轨迹
%plot trajectory
figure;
box on;
hold on;
angle = 180; %要求达到图片审美对齐的角度，所以旋转图形 The point of view of the aesthetic alignment of the picture
rotation_matrix = [cosd(angle)  -sind(angle);
    sind(angle)   cosd(angle)];

pos_r = zeros(2,datasize);


for idx = 1:datasize
    pos_r(:,idx) = rotation_matrix*[pos_n(1,idx) pos_n(2,idx)]';
end
%绘制路线 Draw a route
plot(pos_r(1,:),pos_r(2,:),'LineWidth',2,'Color','r');
%绘制开始符号 Draw the start symbol
start = plot(pos_r(1,1),pos_r(2,1),'Marker','^','LineWidth',1,'LineStyle','none');
%绘制结束符号 Draw the end symbol
stop = plot(pos_r(1,end),pos_r(2,end),'Marker','o','LineWidth',1,'LineStyle','none');

xlabel('x (m)');
ylabel('y (m)');
title('平面路线估计');
legend([start;stop],'开始','结束');
axis equal;
grid;
hold off;
